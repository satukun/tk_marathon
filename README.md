# マラソン フォトシステム

マラソンイベント参加者のリアルタイム写真撮影・管理システムです。参加者登録から写真撮影、確認までの一連の流れをWebアプリケーションで提供します。

## 技術スタック

- **Next.js 14.1.0** - Reactベースのフルスタックフレームワーク
- **TypeScript 5.3.3** - 型安全なJavaScript
- **Tailwind CSS 3.4.1** - ユーティリティファーストCSSフレームワーク
- **Supabase** - PostgreSQLベースのBaaS
- **PWA対応** - オフライン機能とインストール可能

## システム要件

- Node.js 18.17.0以上
- npm/yarn
- 最新のブラウザ（Chrome, Firefox, Safari, Edge）
- iPadサイズの画面を想定した最適化

## 使い方

1. **インストール**:
   プロジェクトのルートディレクトリで以下のコマンドを実行して依存関係をインストールします。
   ```
   npm install
   ```

2. **開発サーバーの起動**:
   開発環境でアプリケーションを起動するには、以下のコマンドを実行します。
   ```
   npm run dev
   ```
   ブラウザで `http://localhost:3000` にアクセスしてアプリケーションを確認できます。

3. **ビルド**:
   本番環境用にアプリケーションをビルドするには、以下のコマンドを実行します。
   ```
   npm run build
   ```

4. **本番サーバーの起動**:
   ビルド後にアプリケーションを起動するには、以下のコマンドを実行します。
   ```
   npm run start
   ```

5. **リンターの実行**:
   コード品質をチェックするには、以下のコマンドを使用します。
   ```
   npm run lint
   ```

# 主要機能

## 1. 参加者登録システム (`/runner`)

- **フォーム項目**:
  - ニックネーム（必須）
  - 目標タイム（6桁数字形式：HHMMSS）
  - 意気込みメッセージ（5種類から選択）

- **機能**:
  - 多段階フォーム（入力 → 確認 → 完了）
  - Zodスキーマによるバリデーション
  - 動的メッセージ生成（目標タイムに基づく励ましメッセージ）
  - 一意の参加者ID発行
  - 多言語対応（日本語・英語）

## 2. スタッフ検索・撮影システム (`/staff/search`)

- **検索機能**:
  - 参加者ID検索
  - リアルタイム参加者情報表示

- **カメラ機能**:
  - WebRTC APIによるリアルタイム撮影
  - デバイス選択（複数カメラサポート）
  - 5秒カウントダウン撮影
  - 自動遷移オプション
  - 写真確認・再撮影機能

## 3. PWA機能

- オフライン対応（Service Worker）
- ホーム画面への追加可能
- iPadサイズ最適化
- レスポンシブデザイン

## ドキュメント

- **[プロジェクト概要](プロジェクト概要.md)** - システム全体の詳細仕様
- **[カラーパターン](カラーパターン.md)** - デザインシステムとカラーガイドライン

# テスト項目

## ユニットテスト
1. **`use-toast.ts`**
   - `genId`関数が一意のIDを生成することを確認します。これにより、トーストが一意に識別され、重複がないことを保証します。
   - `reducer`関数が各アクション（`ADD_TOAST`, `UPDATE_TOAST`, `DISMISS_TOAST`, `REMOVE_TOAST`）に対して正しく動作することを確認します。これにより、トーストの追加、更新、非表示、削除が期待通りに行われることを保証します。
   - `toast`関数がトーストを正しく生成し、更新し、非表示にすることを確認します。これにより、ユーザーがトーストを操作する際の一貫性を保証します。
   - `useToast`フックがトーストの状態を正しく管理することを確認します。これにより、トーストの状態がアプリケーション全体で一貫していることを保証します。

## 統合テスト
1. **トースト通知の統合**
   - トースト通知がUI上で正しく表示され、ユーザーの操作に応じて更新・削除されることを確認します。これにより、ユーザーがトーストを視覚的に確認し、操作できることを保証します。
   - 複数のトーストが同時に表示される際の動作を確認します。これにより、トーストが重ならずに表示されることを保証します。

2. **ページ間のナビゲーション**
   - `app/`ディレクトリ内の各ページが正しくレンダリングされ、ナビゲーションが期待通りに動作することを確認します。これにより、ユーザーがアプリケーション内をスムーズに移動できることを保証します。

## エンドツーエンド（E2E）テスト
1. **ユーザーの操作フロー**
   - ユーザーがアプリケーションを通じて行う一連の操作（例：登録、ログイン、データの閲覧）が期待通りに動作することを確認します。これにより、ユーザーエクスペリエンスが一貫していることを保証します。
   - 特に、`app/register/`や`app/runner/`のページでの操作が正しく行われることを確認します。これにより、重要なユーザー操作が正しく処理されることを保証します。

## APIテスト
1. **APIエンドポイントのテスト**
   - `app/api/`ディレクトリ内の各APIエンドポイントが正しくリクエストを処理し、期待通りのレスポンスを返すことを確認します。これにより、バックエンドとフロントエンド間の通信が正しく行われることを保証します。
   - エラーハンドリングが適切に行われていることを確認します。これにより、予期しないエラーが発生した際に、アプリケーションが適切に対応できることを保証します。

これらのテスト要件を基に、具体的なテストケースを作成し、実行することで、アプリケーションの品質を確保します。

## 環境変数設定

本番環境で使用する際は、以下の環境変数を設定してください：

```bash
# Supabase設定
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key

# その他の設定
NEXT_PUBLIC_APP_URL=https://your-domain.com
```

## デプロイメント

1. 環境変数の設定
2. ビルドの実行（`npm run build`）
3. 静的ファイルの配信設定
4. Service Workerの有効化

## 貢献方法

1. フォークしてブランチを作成
2. 機能追加・バグ修正
3. テストの実行確認
4. プルリクエスト作成

詳細な開発ガイドラインは、各ドキュメントファイルを参照してください。
