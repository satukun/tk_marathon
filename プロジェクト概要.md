# マラソン フォトシステム - プロジェクト概要

## プロジェクト概要

このプロジェクトは、マラソンイベント参加者のリアルタイム写真撮影・管理システムです。参加者登録から写真撮影、確認までの一連の流れをWebアプリケーションで提供します。

## 技術スタック

### フロントエンド
- **Next.js 14.1.0** - Reactベースのフルスタックフレームワーク
- **TypeScript 5.3.3** - 型安全なJavaScript
- **Tailwind CSS 3.4.1** - ユーティリティファーストCSSフレームワーク
- **Radix UI** - アクセシブルなUIコンポーネントライブラリ
- **Framer Motion 11.0.8** - アニメーションライブラリ

### バックエンド・データベース
- **Supabase** - PostgreSQLベースのBaaS（Backend as a Service）
- **Row Level Security (RLS)** - データベースレベルのセキュリティ

### PWA対応
- **next-pwa 5.6.0** - Progressive Web App機能
- **Service Worker** - オフライン対応とキャッシュ機能

### 国際化
- **react-i18next 14.1.0** - 多言語対応（日本語・英語）
- **i18next-browser-languagedetector** - ブラウザ言語自動検出

### UI/UX
- **Lucide React** - アイコンライブラリ
- **Sonner** - トースト通知
- **React Hook Form + Zod** - フォームバリデーション

## アプリケーション構造

### ページ構成

#### 1. ホームページ (`/`)
- 参加者登録と検索の入り口
- 2つのメインアクション：
  - 参加者登録（`/runner`）
  - 参加者検索・撮影（`/staff/search`）

#### 2. 参加者登録ページ (`/runner`)
- 参加者情報の入力フォーム
- 入力項目：
  - ニックネーム
  - 目標タイム（6桁数字形式）
  - 意気込みメッセージ（5種類から選択）
- 確認画面での内容チェック
- 登録完了時に一意の参加者IDを発行

#### 3. スタッフ検索・撮影ページ (`/staff/search`)
- 参加者ID検索機能
- リアルタイムカメラ撮影
- 写真確認・承認フロー

### データベース構造

```sql
-- runners テーブル
CREATE TABLE runners (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  runner_id text UNIQUE NOT NULL,        -- 参加者ID
  nickname text NOT NULL,                -- ニックネーム
  language text NOT NULL,                -- 言語設定
  target_time text NOT NULL,             -- 目標タイム
  message text NOT NULL,                 -- 意気込みメッセージ
  created_at timestamptz DEFAULT now()   -- 登録日時
);
```

### API エンドポイント

#### 参加者関連
- `POST /api/runners` - 参加者登録
- `GET /api/runners/[id]` - 参加者情報取得

#### ファイルアップロード
- `POST /api/upload` - 写真アップロード

## 主要機能

### 1. 参加者登録システム
- **多段階フォーム**: 入力 → 確認 → 完了
- **バリデーション**: Zodスキーマによる型安全な検証
- **動的メッセージ生成**: 目標タイムと意気込みに基づく励ましメッセージ
- **多言語対応**: 日本語・英語の切り替え

### 2. カメラシステム
- **リアルタイム撮影**: WebRTC APIによるカメラアクセス
- **デバイス選択**: 複数カメラからの選択機能
- **カウントダウン撮影**: 5秒カウントダウン
- **自動遷移オプション**: 撮影後の自動画面遷移

### 3. PWA機能
- **オフライン対応**: Service Workerによるキャッシュ
- **インストール可能**: ホーム画面への追加
- **レスポンシブデザイン**: iPadサイズを想定した最適化

### 4. セキュリティ
- **Row Level Security**: Supabaseでのデータ保護
- **公開読み取り専用**: 参加者情報の安全な公開
- **CORS設定**: 適切なクロスオリジンアクセス制御

## 開発環境

### 必要な環境
- **Node.js**: 18.17.0以上
- **Package Manager**: npm/yarn
- **Supabase**: データベース・認証

### 開発コマンド
```bash
# 開発サーバー起動
npm run dev

# ビルド
npm run build

# プロダクションサーバー起動
npm run start

# リンター実行
npm run lint
```

### 設定ファイル

#### Next.js設定 (`next.config.js`)
- PWA設定（next-pwa）
- Supabaseキャッシュ設定
- 画像最適化無効化
- face-api.js用webpack設定

#### TypeScript設定 (`tsconfig.json`)
- ES5ターゲット
- モジュール解決設定
- パスエイリアス（`@/*`）

## デプロイメント

### 環境変数
- Supabase接続情報
- 画像アップロード設定

### ビルド最適化
- 静的アセットの最適化
- Service Workerの自動生成
- TypeScript・ESLintエラーの無視設定（本番用）

## 特徴的な実装

### 1. 多言語メッセージシステム
- 動的メッセージ生成配列（`data/messages-array-ja.ts`, `data/messages-array-en.ts`）
- 目標タイムカテゴリ別の励ましメッセージ
- ランダム選択による多様性

### 2. リアルタイム画像処理
- Canvas APIによる画像キャプチャ
- Base64エンコーディング
- 即座のプレビュー表示

### 3. 状態管理
- React Hooksベースの状態管理
- フォーム状態とUI状態の分離
- エラーハンドリングとローディング状態

## 今後の拡張可能性

1. **顔認識機能**: face-api.jsの活用
2. **画像加工**: フィルターやテキスト合成
3. **SNS連携**: 撮影画像の直接シェア
4. **リアルタイム通知**: 撮影完了の即時通知
5. **分析機能**: 参加者データの統計・分析

このシステムは、マラソンイベントでの参加者体験向上と、効率的な写真管理を実現する包括的なソリューションとなっています。
